<div class="pull-right">
    {{#if question}}
    {{#if isPublic}}
    <div class="mr-1 d-inline">
        <span class="fa-stack fa-lg mb-2">
            <i class="fa fa-eye" data-toggle="tooltip" title="Pytanie jest publiczne!"></i>
        </span>
    </div>
    {{/if}}
    {{#if isPrivate}}
    <form action="/question/pending/{{question.id}}" method="POST" class="m-0 p-0 d-inline">
        <button type="submit" class="btn btn-primary mb-2" name="action">
            <i class="fa fa-share-alt" data-toggle="tooltip" title="Poproś o upublicznienie pytania"></i>
        </button>
    </form>
    {{else}}
    <form action="/question/revoke/{{question.id}}" method="POST" class="m-0 p-0 d-inline">
        <button type="submit" class="btn btn-primary mb-2" name="action">
            <i class="fa fa-share fa-rotate-180" data-toggle="tooltip" title="Wycofaj prośbę o upublicznienie"></i>
        </button>
    </form>
    {{/if}}
    <button class="btn btn-danger mb-2" data-toggle="modal" data-target="#deleteQuestionModal">
        <i class="fa fa-trash" data-toggle="tooltip" title="Usuń to pytanie"></i>
    </button>
    {{else}}
    <a class="btn btn-primary mb-2" href="/question/upload">
        <i class="fa fa-upload" data-toggle="tooltip" title="Wstaw pytania z pliku"></i>
    </a>
    {{/if}}
</div>

<form action="/question{{#if question}}/{{question.id}}{{/if}}" method="post" class="m-0">
    <div class="form-group mb-3">
        <label for="questionTextarea" class="pt-2">Treść pytania:</label>
        <textarea class="form-control" required id="questionTextarea" rows="3" maxlength="{{maxQuestionLength}}"
            name="question[text]">{{question.text}}</textarea>
        <span class="character-count pull-right badge badge-dark" id="charLengthLabel"></span>
        <input type="hidden" name="question[status]" value="{{question.status}}" />
    </div>
    <label>Odpowiedzi:</label>
    {{#each answers}}
    <div class="input-group mb-1">
        <input type="hidden" name="answer[{{@index}}][id]" value="{{this.id}}" />
        <input type="text" class="form-control" required name="answer[{{@index}}][text]" value="{{this.text}}"
            aria-label="Treść odpowiedzi" maxlength="{{../maxQuestionLength}}" />
        <div class="input-group-append">
            <div class="input-group-text" style="padding-right: 4px;">
                <div class="custom-control custom-checkbox" aria-label="Poprawna?" title="Czy poprawna?"
                    data-toggle="tooltip" data-placement="left">
                    <input type="checkbox" class="custom-control-input oce-checkbox" id="check-{{@index}}"
                        name="answer[{{@index}}][correct]" value="1" {{#if this.correct}}checked{{/if}} />
                    <label class="custom-control-label m-0" for="check-{{@index}}"></label>
                </div>
            </div>
        </div>
    </div>
    {{/each}}
    <div class="form-group mt-3">
        <label for="categorySelect">Kategoria</label>
        <select class="form-control custom-select selectpicker" data-live-search="true" data-size="5" name="category"
            id="categorySelect">
            {{#each categories}}
            <option value="{{this.id}}" {{#check this.id ../selected}} selected{{/check}}>
                {{this.name}}</option>
            {{/each}}
        </select>
    </div>
    <button class="btn btn-primary btn-block mt-2" type="submit" name="action">Zapisz pytanie</button>
</form>

<!-- Modal -->
<div class="modal fade" id="deleteQuestionModal" tabindex="-1" role="dialog" aria-labelledby="deleteQuestionModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteQuestionModalLabel">Potwierdzenie usunięcia</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p>Czy na pewno chcesz usunąć to pytanie?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Anuluj</button>
                <form action="/question/{{question.id}}?_method=DELETE" method="POST" class="m-0">
                    <button type="submit" class="btn btn-danger" name="action">Usuń</button>
                </form>
            </div>
        </div>
    </div>
</div>

{{#if questionAdded}}
<div style="position: absolute; left: 0; top: 30%; width: 100%;">
    <div style="margin: auto" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-delay="3000">
        <div class="toast-header">
            <strong class="mr-auto">Ocelot</strong>
            <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="toast-body">
            Pytanie zostało dodane. <a href="/question/{{questionAdded}}">Przejdź do pytania</a>
        </div>
    </div>
</div>
{{/if}}

<script>
    $('.toast').toast('show');
    const textMaxLength = {{ maxQuestionLength }};
    const currentLength = $('#questionTextarea').val().length;
    const text_remaining = textMaxLength - currentLength;

    $('#charLengthLabel').html(currentLength + ' / ' + textMaxLength);

    $('#questionTextarea').keyup(function () {
        const currentLength = $('#questionTextarea').val().length;
        const text_remaining = textMaxLength - currentLength;

        $('#charLengthLabel').html(currentLength + ' / ' + textMaxLength);
    });
</script>